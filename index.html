<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=375, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Carriage9 ‚Ä¢ Food Delivery Mockup (AP & Telangana)</title>
  <style>
    :root{
      --bg:#ffffff;
      --text:#121417;
      --muted:#6b7280;
      --line:#e5e7eb;
      --card:#ffffff;
      --shadow: 0 10px 25px rgba(0,0,0,.08);
      --accent:#FF6B35;
      --accent2:#E9442E;
      --green:#16a34a;
      --yellow:#f59e0b;
      --chip:#fff3ed;
      --danger:#ef4444;
      --radius:18px;
      --radius2:14px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans", "Noto Sans Telugu", sans-serif;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background: linear-gradient(180deg,#fff 0%, #fff 60%, #fff7f2 100%);
      font-family:var(--font);
      color:var(--text);
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding:18px 12px 30px;
    }

    /* Phone frame */
    .phone{
      width:375px;
      min-height:780px;
      background:var(--bg);
      border:1px solid var(--line);
      border-radius:28px;
      box-shadow:0 25px 60px rgba(0,0,0,.18);
      overflow:hidden;
      position:relative;
    }

    .statusbar{
      height:26px;
      padding:6px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      font-size:12px;
      color:#111827;
      background:linear-gradient(180deg,#fff7f2, #fff);
      border-bottom:1px solid rgba(229,231,235,.6);
    }
    .sb-right{display:flex; gap:8px; align-items:center; color:#111827}
    .pill{padding:2px 8px; border-radius:999px; border:1px solid rgba(229,231,235,.9); background:#fff; font-size:11px}

    .app{
      display:flex;
      flex-direction:column;
      height:calc(780px - 26px);
    }

    header{
      padding:14px 14px 10px;
      display:flex;
      align-items:center;
      gap:10px;
      border-bottom:1px solid rgba(229,231,235,.75);
      background:linear-gradient(180deg,#ffffff 0%, #fff7f2 120%);
      position:sticky;
      top:0;
      z-index:10;
    }
    .back{
      width:36px; height:36px;
      border-radius:12px;
      border:1px solid var(--line);
      background:#fff;
      display:grid;
      place-items:center;
      cursor:pointer;
      user-select:none;
    }
    .back:active{transform:scale(.98)}
    .titleWrap{flex:1; min-width:0}
    .title{font-weight:800; letter-spacing:-.02em; font-size:15px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
    .subtitle{font-size:12px; color:var(--muted); margin-top:2px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}

    .actions{display:flex; gap:8px; align-items:center}
    .iconBtn{
      width:36px; height:36px; border-radius:12px;
      border:1px solid var(--line);
      background:#fff;
      display:grid; place-items:center;
      cursor:pointer;
      user-select:none;
    }

    main{
      padding:14px;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
      flex:1;
      background:var(--bg);
    }

    .card{
      background:var(--card);
      border:1px solid rgba(229,231,235,.9);
      border-radius:var(--radius);
      box-shadow: 0 10px 28px rgba(17,24,39,.06);
      padding:12px;
    }

    .row{display:flex; align-items:center; justify-content:space-between; gap:10px}
    .col{display:flex; flex-direction:column; gap:8px}

    .btn{
      border:0;
      border-radius:16px;
      padding:12px 14px;
      font-weight:800;
      cursor:pointer;
      background:linear-gradient(135deg,var(--accent),var(--accent2));
      color:#fff;
      box-shadow: 0 12px 24px rgba(255,107,53,.25);
    }
    .btn:active{transform:translateY(1px)}

    .btnSecondary{
      border:1px solid var(--line);
      background:#fff;
      color:#111827;
      box-shadow:none;
      font-weight:800;
    }

    .btnGhost{
      border:1px dashed rgba(255,107,53,.45);
      background:rgba(255,107,53,.08);
      color:#9a3412;
      box-shadow:none;
      font-weight:900;
    }

    .tabs{
      position:sticky;
      bottom:0;
      z-index:20;
      border-top:1px solid rgba(229,231,235,.9);
      background:rgba(255,255,255,.96);
      backdrop-filter: blur(8px);
      padding:10px 10px 14px;
    }
    .tabRow{display:grid; grid-template-columns: repeat(5, 1fr); gap:6px}
    .tab{
      border:1px solid transparent;
      background:transparent;
      color:#374151;
      border-radius:14px;
      padding:8px 6px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:6px;
      cursor:pointer;
      font-size:11px;
      font-weight:800;
    }
    .tab.active{
      background:rgba(255,107,53,.10);
      border-color:rgba(255,107,53,.25);
      color:#9a3412;
    }
    .tab svg{width:18px; height:18px}

    /* UI atoms */
    .chips{display:flex; gap:8px; flex-wrap:wrap}
    .chip{
      padding:8px 10px;
      border-radius:999px;
      background:var(--chip);
      border:1px solid rgba(255,107,53,.22);
      color:#9a3412;
      font-weight:800;
      font-size:12px;
      cursor:pointer;
      user-select:none;
    }
    .chip.active{background:rgba(255,107,53,.18); border-color:rgba(255,107,53,.35)}

    .search{
      display:flex; gap:10px; align-items:center;
      padding:10px 12px;
      border-radius:16px;
      border:1px solid rgba(229,231,235,.95);
      background:#fff;
    }
    .search input{
      border:0;
      outline:none;
      width:100%;
      font-size:13px;
    }

    .grid2{display:grid; grid-template-columns: 1fr 1fr; gap:10px}
    .grid3{display:grid; grid-template-columns: repeat(3, 1fr); gap:10px}

    .cat{
      border-radius:18px;
      border:1px solid rgba(229,231,235,.9);
      padding:12px;
      background: linear-gradient(180deg,#fff, #fff7f2);
      cursor:pointer;
      user-select:none;
      min-height:92px;
      position:relative;
      overflow:hidden;
    }
    .cat .emoji{font-size:22px}
    .cat .name{font-weight:900; margin-top:8px; font-size:13px}
    .cat .hint{font-size:11px; color:var(--muted); margin-top:4px}
    .cat:after{
      content:"";
      width:90px; height:90px;
      border-radius:24px;
      background: radial-gradient(circle at 30% 30%, rgba(255,107,53,.22), rgba(255,107,53,0));
      position:absolute;
      right:-25px; bottom:-25px;
    }

    .offer{
      border-radius:22px;
      padding:14px;
      border:1px solid rgba(255,107,53,.22);
      background: linear-gradient(135deg, rgba(255,107,53,.16), rgba(233,68,46,.06));
    }
    .offer .big{font-size:16px; font-weight:950; letter-spacing:-.02em}
    .offer .small{color:#7c2d12; font-weight:800; font-size:12px; margin-top:6px}

    .list{display:flex; flex-direction:column; gap:10px}
    .rCard{
      border-radius:22px;
      border:1px solid rgba(229,231,235,.95);
      background:#fff;
      padding:12px;
      cursor:pointer;
      user-select:none;
    }
    .rTop{display:flex; gap:10px; align-items:flex-start}
    .thumb{
      width:56px; height:56px;
      border-radius:16px;
      background: linear-gradient(135deg, rgba(255,107,53,.35), rgba(233,68,46,.12));
      display:grid; place-items:center;
      font-weight:1000;
      color:#7c2d12;
      border:1px solid rgba(255,107,53,.25);
      flex:0 0 auto;
    }
    .rName{font-weight:950; font-size:14px; letter-spacing:-.01em}
    .rMeta{margin-top:4px; font-size:12px; color:var(--muted)}
    .badges{display:flex; gap:6px; flex-wrap:wrap; margin-top:8px}
    .badge{
      font-size:11px;
      font-weight:900;
      border-radius:999px;
      padding:5px 8px;
      border:1px solid rgba(229,231,235,.95);
      background:#fff;
      color:#111827;
    }
    .badge.green{border-color:rgba(22,163,74,.25); background:rgba(22,163,74,.08); color:#14532d}
    .badge.yellow{border-color:rgba(245,158,11,.25); background:rgba(245,158,11,.10); color:#7c2d12}

    .sectionTitle{font-weight:950; letter-spacing:-.02em; margin:14px 0 10px; font-size:14px}

    .menuItem{
      border-radius:22px;
      border:1px solid rgba(229,231,235,.95);
      padding:12px;
      background:#fff;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
    }
    .menuLeft{display:flex; gap:10px; align-items:flex-start}
    .vegDot{width:10px; height:10px; border-radius:3px; border:2px solid var(--green); margin-top:3px}
    .nonVegDot{width:10px; height:10px; border-radius:3px; border:2px solid var(--danger); margin-top:3px}
    .mName{font-weight:950; font-size:13px}
    .mDesc{font-size:12px; color:var(--muted); margin-top:4px}
    .mPrice{font-weight:950; margin-top:8px}
    .addBtn{
      border-radius:14px;
      border:1px solid rgba(255,107,53,.35);
      background:rgba(255,107,53,.10);
      padding:10px 12px;
      font-weight:950;
      cursor:pointer;
      color:#9a3412;
      user-select:none;
    }

    .divider{height:1px; background:rgba(229,231,235,.95); margin:12px 0}

    .kv{display:flex; align-items:center; justify-content:space-between; gap:10px; font-size:13px}
    .kv .k{color:var(--muted); font-weight:800}
    .kv .v{font-weight:950}

    .stepper{display:flex; gap:8px; align-items:center}
    .stepper button{
      width:34px; height:34px;
      border-radius:12px;
      border:1px solid rgba(229,231,235,.95);
      background:#fff;
      font-weight:1000;
      cursor:pointer;
    }
    .qty{min-width:18px; text-align:center; font-weight:950}

    .map{
      height:210px;
      border-radius:22px;
      border:1px dashed rgba(255,107,53,.55);
      background: linear-gradient(135deg, rgba(255,107,53,.10), rgba(233,68,46,.05));
      display:flex;
      align-items:center;
      justify-content:center;
      flex-direction:column;
      gap:10px;
      color:#9a3412;
      text-align:center;
      padding:16px;
    }

    .smallNote{font-size:12px; color:var(--muted); line-height:1.35}
    .toast{
      position:absolute;
      left:50%;
      transform:translateX(-50%);
      bottom:86px;
      background:#111827;
      color:#fff;
      padding:10px 12px;
      border-radius:999px;
      font-weight:900;
      font-size:12px;
      opacity:0;
      pointer-events:none;
      transition:opacity .2s ease, transform .2s ease;
      max-width:340px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .toast.show{opacity:1; transform:translateX(-50%) translateY(-4px)}

    /* Onboarding hero */
    .hero{
      border-radius:26px;
      border:1px solid rgba(255,107,53,.18);
      background: radial-gradient(circle at 20% 10%, rgba(255,107,53,.25), rgba(255,107,53,0) 45%),
                  radial-gradient(circle at 80% 30%, rgba(233,68,46,.18), rgba(233,68,46,0) 52%),
                  linear-gradient(180deg,#fff, #fff7f2);
      padding:16px;
      overflow:hidden;
      position:relative;
    }
    .brand{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .logo{
      width:44px; height:44px;
      border-radius:16px;
      background:linear-gradient(135deg,var(--accent),var(--accent2));
      display:grid; place-items:center;
      font-weight:1000;
      color:#fff;
      box-shadow: 0 16px 26px rgba(255,107,53,.25);
    }
    .brandName{font-weight:1000; letter-spacing:-.03em; font-size:16px}
    .tag{font-size:12px; color:#7c2d12; font-weight:900}

    .langRow{display:flex; gap:10px; margin-top:12px}
    .langBtn{flex:1}

    .radioRow{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .radio{
      display:flex; align-items:center; gap:8px;
      padding:10px 12px;
      border-radius:16px;
      border:1px solid rgba(229,231,235,.95);
      background:#fff;
      cursor:pointer;
      user-select:none;
      font-weight:900;
      font-size:12px;
    }
    .dot{width:12px; height:12px; border-radius:999px; border:2px solid rgba(255,107,53,.45)}
    .radio.active{border-color:rgba(255,107,53,.35); background:rgba(255,107,53,.08)}
    .radio.active .dot{background:linear-gradient(135deg,var(--accent),var(--accent2)); border-color:transparent}

    .footerPad{height:10px}
  </style>
</head>
<body>
  <div class="phone" id="phone">
    <div class="statusbar">
      <div id="sbTime">02:23</div>
      <div class="sb-right">
        <span class="pill" id="sbCity">Vijayawada</span>
        <span class="pill">5G</span>
        <span class="pill">92%</span>
      </div>
    </div>

    <div class="app">
      <header>
        <div class="back" id="backBtn" title="Back" aria-label="Back" style="visibility:hidden">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
        </div>
        <div class="titleWrap">
          <div class="title" id="headerTitle">Carriage9</div>
          <div class="subtitle" id="headerSubtitle">AP & Telangana ‚Ä¢ Fast, local, Telugu-first</div>
        </div>
        <div class="actions">
          <div class="iconBtn" id="langToggle" title="Language" aria-label="Language">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 5h7"/><path d="M7 4v2"/><path d="M4 9h7"/><path d="M9 9s-1 4-5 6"/><path d="M12 20l4-9 4 9"/><path d="M14 16h4"/></svg>
          </div>
          <div class="iconBtn" id="helpBtn" title="Quick tips" aria-label="Help">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 1 1 5.83 1c0 2-3 2-3 4"/><path d="M12 17h.01"/></svg>
          </div>
        </div>
      </header>

      <main id="main"></main>

      <div class="tabs" id="bottomTabs" style="display:none">
        <div class="tabRow">
          <button class="tab" data-tab="home" aria-label="Home">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7"/><path d="M9 22V12h6v10"/></svg>
            <div id="tabHome">Home</div>
          </button>
          <button class="tab" data-tab="search" aria-label="Search">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.3-4.3"/></svg>
            <div id="tabSearch">Search</div>
          </button>
          <button class="tab" data-tab="restaurants" aria-label="Restaurants">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 10h18"/><path d="M5 6h14"/><path d="M6 14h12"/><path d="M7 18h10"/></svg>
            <div id="tabRestaurants">Restaurants</div>
          </button>
          <button class="tab" data-tab="cart" aria-label="Cart">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.6 13.3a2 2 0 0 0 2 1.7h9.7a2 2 0 0 0 2-1.6L23 6H6"/></svg>
            <div id="tabCart">Cart</div>
          </button>
          <button class="tab" data-tab="profile" aria-label="Profile">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            <div id="tabProfile">Profile</div>
          </button>
        </div>
      </div>

      <div class="toast" id="toast"></div>
    </div>
  </div>

<script>
(function(){
  const $ = (sel, el=document) => el.querySelector(sel);
  const $$ = (sel, el=document) => Array.from(el.querySelectorAll(sel));

  const state = {
    lang: localStorage.getItem('c9_lang') || 'te', // te or en
    city: localStorage.getItem('c9_city') || 'Vijayawada',
    stack: [],
    tab: 'home',
    selectedCategory: 'Biryani',
    selectedRestaurantId: 'r1',
    selectedItemId: 'i1',
    searchQuery: '',
    filters: {
      sort: 'Relevance',
      vegOnly: false,
      rating4plus: true,
      maxDeliveryFee: 30,
    },
    cart: JSON.parse(localStorage.getItem('c9_cart') || '[]'),
    order: JSON.parse(localStorage.getItem('c9_order') || 'null')
  };

  const i18n = {
    en: {
      app: 'Carriage9',
      tagline: 'AP & Telangana ‚Ä¢ Fast, local, Telugu-first',
      orderFood: 'Order food',
      orderFoodTe: '‡∞Ü‡∞π‡∞æ‡∞∞‡∞Ç ‡∞Ü‡∞∞‡±ç‡∞°‡∞∞‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø',
      restaurants: 'Restaurants',
      menu: 'Menu',
      orderTracking: 'Order Tracking',
      home: 'Home',
      search: 'Search',
      cart: 'Cart',
      profile: 'Profile',
      city: 'City',
      onboardingTitle: 'Delicious meals, delivered',
      onboardingSub: 'Choose language and your city to begin.',
      continue: 'Continue',
      chooseLang: 'Language',
      chooseCity: 'Pick your city',
      telugu: 'Telugu',
      english: 'English',
      categories: 'Categories',
      offers: 'Offers',
      featured: 'Featured near you',
      viewAll: 'View all',
      filters: 'Filters',
      sort: 'Sort',
      rating: 'Rating',
      vegOnly: 'Veg only',
      deliveryFee: 'Delivery fee',
      add: 'Add',
      customize: 'Customize',
      spicy: 'Spice level',
      addOns: 'Add-ons',
      instructions: 'Instructions',
      addToCart: 'Add to cart',
      checkout: 'Checkout',
      payNow: 'Pay now',
      address: 'Delivery address',
      payment: 'Payment',
      upi: 'UPI',
      cod: 'Cash on Delivery',
      est: 'ETA',
      track: 'Track',
      reorder: 'Reorder',
      pastOrders: 'Order history',
      help: 'Help',
    },
    te: {
      app: 'Carriage9',
      tagline: '‡∞Ü‡∞Ç‡∞ß‡±ç‡∞∞‡∞™‡±ç‡∞∞‡∞¶‡±á‡∞∂‡±ç & ‡∞§‡±Ü‡∞≤‡∞Ç‡∞ó‡∞æ‡∞£ ‚Ä¢ ‡∞µ‡±á‡∞ó‡∞Ç‡∞ó‡∞æ ‚Ä¢ ‡∞∏‡±ç‡∞•‡∞æ‡∞®‡∞ø‡∞ï‡∞Ç‡∞ó‡∞æ',
      orderFood: '‡∞Ü‡∞π‡∞æ‡∞∞‡∞Ç ‡∞Ü‡∞∞‡±ç‡∞°‡∞∞‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø',
      orderFoodTe: '‡∞Ü‡∞π‡∞æ‡∞∞‡∞Ç ‡∞Ü‡∞∞‡±ç‡∞°‡∞∞‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø',
      restaurants: '‡∞∞‡±Ü‡∞∏‡±ç‡∞ü‡∞æ‡∞∞‡±Ü‡∞Ç‡∞ü‡±ç‡∞≤‡±Å',
      menu: '‡∞Æ‡±Ü‡∞®‡±Ç',
      orderTracking: '‡∞Ü‡∞∞‡±ç‡∞°‡∞∞‡±ç ‡∞ü‡±ç‡∞∞‡∞æ‡∞ï‡∞ø‡∞Ç‡∞ó‡±ç',
      home: '‡∞π‡±ã‡∞Æ‡±ç',
      search: '‡∞µ‡±Ü‡∞§‡∞ï‡∞Ç‡∞°‡∞ø',
      cart: '‡∞ï‡∞æ‡∞∞‡±ç‡∞ü‡±ç',
      profile: '‡∞™‡±ç‡∞∞‡±ä‡∞´‡±à‡∞≤‡±ç',
      city: '‡∞®‡∞ó‡∞∞‡∞Ç',
      onboardingTitle: '‡∞∞‡±Å‡∞ö‡∞ø‡∞ï‡∞∞‡∞Æ‡±à‡∞® ‡∞≠‡±ã‡∞ú‡∞®‡∞Ç, ‡∞Æ‡±Ä ‡∞á‡∞Ç‡∞ü‡∞ø‡∞ï‡∞ø',
      onboardingSub: '‡∞≠‡∞æ‡∞∑ & ‡∞Æ‡±Ä ‡∞®‡∞ó‡∞∞‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø.',
      continue: '‡∞ï‡±ä‡∞®‡∞∏‡∞æ‡∞ó‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø',
      chooseLang: '‡∞≠‡∞æ‡∞∑',
      chooseCity: '‡∞Æ‡±Ä ‡∞®‡∞ó‡∞∞‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø',
      telugu: '‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å',
      english: '‡∞á‡∞Ç‡∞ó‡±ç‡∞≤‡±Ä‡∞∑‡±ç',
      categories: '‡∞ï‡±á‡∞ü‡∞ó‡∞ø‡∞∞‡±Ä‡∞≤‡±Å',
      offers: '‡∞Ü‡∞´‡∞∞‡±ç‡∞≤‡±Å',
      featured: '‡∞Æ‡±Ä ‡∞¶‡∞ó‡±ç‡∞ó‡∞∞ ‡∞™‡±ç‡∞∞‡∞∏‡∞ø‡∞¶‡±ç‡∞ß‡∞Æ‡±à‡∞®‡∞µ‡∞ø',
      viewAll: '‡∞Ö‡∞®‡±ç‡∞®‡±Ä ‡∞ö‡±Ç‡∞°‡∞Ç‡∞°‡∞ø',
      filters: '‡∞´‡∞ø‡∞≤‡±ç‡∞ü‡∞∞‡±ç‡∞≤‡±Å',
      sort: '‡∞ï‡±ç‡∞∞‡∞Æ‡∞Ç',
      rating: '‡∞∞‡±á‡∞ü‡∞ø‡∞Ç‡∞ó‡±ç',
      vegOnly: '‡∞∂‡∞æ‡∞ï‡∞æ‡∞π‡∞æ‡∞∞‡∞Ç ‡∞Æ‡∞æ‡∞§‡±ç‡∞∞‡∞Æ‡±á',
      deliveryFee: '‡∞°‡±Ü‡∞≤‡∞ø‡∞µ‡∞∞‡±Ä ‡∞´‡±Ä',
      add: '‡∞ú‡±ã‡∞°‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø',
      customize: '‡∞ï‡∞∏‡±ç‡∞ü‡∞Æ‡±à‡∞ú‡±ç',
      spicy: '‡∞ï‡∞æ‡∞∞‡∞Ç ‡∞∏‡±ç‡∞•‡∞æ‡∞Ø‡∞ø',
      addOns: '‡∞Ö‡∞°‡±ç‡∞°‡∞æ‡∞®‡±ç‚Äå‡∞≤‡±Å',
      instructions: '‡∞ó‡∞Æ‡∞®‡∞ø‡∞ï‡∞≤‡±Å',
      addToCart: '‡∞ï‡∞æ‡∞∞‡±ç‡∞ü‡±ç‚Äå‡∞ï‡∞ø ‡∞ú‡±ã‡∞°‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø',
      checkout: '‡∞ö‡±Ü‡∞ï‡±å‡∞ü‡±ç',
      payNow: '‡∞á‡∞™‡±ç‡∞™‡±Å‡∞°‡±á ‡∞ö‡±Ü‡∞≤‡±ç‡∞≤‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø',
      address: '‡∞°‡±Ü‡∞≤‡∞ø‡∞µ‡∞∞‡±Ä ‡∞ö‡∞ø‡∞∞‡±Å‡∞®‡∞æ‡∞Æ‡∞æ',
      payment: '‡∞ö‡±Ü‡∞≤‡±ç‡∞≤‡∞ø‡∞Ç‡∞™‡±Å',
      upi: '‡∞Ø‡±Ç‡∞™‡±Ä‡∞ê',
      cod: '‡∞ï‡±ç‡∞Ø‡∞æ‡∞∑‡±ç ‡∞Ü‡∞®‡±ç ‡∞°‡±Ü‡∞≤‡∞ø‡∞µ‡∞∞‡±Ä',
      est: '‡∞Ö‡∞Ç‡∞ö‡∞®‡∞æ ‡∞∏‡∞Æ‡∞Ø‡∞Ç',
      track: '‡∞ü‡±ç‡∞∞‡∞æ‡∞ï‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø',
      reorder: '‡∞Æ‡∞≥‡±ç‡∞≤‡±Ä ‡∞Ü‡∞∞‡±ç‡∞°‡∞∞‡±ç',
      pastOrders: '‡∞Ü‡∞∞‡±ç‡∞°‡∞∞‡±ç ‡∞ö‡∞∞‡∞ø‡∞§‡±ç‡∞∞',
      help: '‡∞∏‡∞π‡∞æ‡∞Ø‡∞Ç',
    }
  };

  const data = {
    cities: ['Vijayawada','Visakhapatnam','Warangal','Guntur','Tirupati','Kakinada','Hyderabad'],
    categories: [
      {id:'cat_biryani', name:{en:'Biryani', te:'‡∞¨‡∞ø‡∞∞‡±ç‡∞Ø‡∞æ‡∞®‡±Ä'}, emoji:'üçó', hint:{en:'Dum, spicy, local', te:'‡∞¶‡∞Æ‡±ç, ‡∞ï‡∞æ‡∞∞‡∞Ç, ‡∞∏‡±ç‡∞•‡∞æ‡∞®‡∞ø‡∞ï ‡∞∞‡±Å‡∞ö‡∞ø'}},
      {id:'cat_meals', name:{en:'Meals', te:'‡∞≠‡±ã‡∞ú‡∞®‡∞Ç'}, emoji:'üçõ', hint:{en:'Andhra meals', te:'‡∞Ü‡∞Ç‡∞ß‡±ç‡∞∞ ‡∞≠‡±ã‡∞ú‡∞®‡∞Ç'}},
      {id:'cat_tiffins', name:{en:'Tiffins', te:'‡∞ü‡∞ø‡∞´‡∞ø‡∞®‡±ç‡∞≤‡±Å'}, emoji:'ü•û', hint:{en:'Idli, dosa', te:'‡∞á‡∞°‡±ç‡∞≤‡±Ä, ‡∞¶‡±ã‡∞∏'}},
      {id:'cat_sweets', name:{en:'Sweets', te:'‡∞∏‡±ç‡∞µ‡±Ä‡∞ü‡±ç‡∞≤‡±Å'}, emoji:'üç¨', hint:{en:'Ariselu & more', te:'‡∞Ö‡∞∞‡∞ø‡∞∏‡±Ü‡∞≤‡±Å & ‡∞Æ‡∞∞‡∞ø‡∞®‡±ç‡∞®‡∞ø'}},
      {id:'cat_home', name:{en:'Home Food', te:'‡∞á‡∞Ç‡∞ü‡∞ø ‡∞≠‡±ã‡∞ú‡∞®‡∞Ç'}, emoji:'üè†', hint:{en:'Home-chef specials', te:'‡∞π‡±ã‡∞Æ‡±ç ‡∞ö‡±Ü‡∞´‡±ç ‡∞∏‡±ç‡∞™‡±Ü‡∞∑‡∞≤‡±ç'}},
      {id:'cat_fast', name:{en:'Fast Food', te:'‡∞´‡∞æ‡∞∏‡±ç‡∞ü‡±ç ‡∞´‡±Å‡∞°‡±ç'}, emoji:'üçî', hint:{en:'Burgers, rolls', te:'‡∞¨‡∞∞‡±ç‡∞ó‡∞∞‡±ç, ‡∞∞‡±ã‡∞≤‡±ç'}},
    ],
    offers: [
      {id:'o1', big:{en:'FREE delivery over ‚Çπ199', te:'‚Çπ199 ‡∞™‡±à‡∞ó‡∞æ ‡∞´‡±ç‡∞∞‡±Ä ‡∞°‡±Ü‡∞≤‡∞ø‡∞µ‡∞∞‡±Ä'}, small:{en:'Telugu states launch offer', te:'‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å ‡∞∞‡∞æ‡∞∑‡±ç‡∞ü‡±ç‡∞∞‡∞æ‡∞≤ ‡∞≤‡∞æ‡∞Ç‡∞ö‡±ç ‡∞Ü‡∞´‡∞∞‡±ç'}},
      {id:'o2', big:{en:'50% OFF ‚Ä¢ up to ‚Çπ100', te:'50% ‡∞Ü‡∞´‡±ç ‚Ä¢ ‚Çπ100 ‡∞µ‡∞∞‡∞ï‡±Å'}, small:{en:'Use code: TELUGU', te:'‡∞ï‡±ã‡∞°‡±ç: TELUGU'}},
    ],
    restaurants: [
      {id:'r1', name:'Andhra Spice Kitchen', area:{en:'Benz Circle', te:'‡∞¨‡±Ü‡∞®‡±ç‡∞ú‡±ç ‡∞∏‡∞∞‡±ç‡∞ï‡∞ø‡∞≤‡±ç'}, city:'Vijayawada', rating:4.5, time:'28‚Äì35 min', fee:19, tags:['Andhra','Meals','Spicy'], featured:true},
      {id:'r2', name:'Godavari Biryani House', area:{en:'Labbipet', te:'‡∞≤‡∞¨‡±ç‡∞¨‡±Ä‡∞™‡±á‡∞ü'}, city:'Vijayawada', rating:4.3, time:'25‚Äì30 min', fee:29, tags:['Biryani','Dum','Non-veg'], featured:true},
      {id:'r3', name:'Ulavacharu Tiffins', area:{en:'Madhurawada', te:'‡∞Æ‡∞ß‡±Å‡∞∞‡∞µ‡∞æ‡∞°'}, city:'Visakhapatnam', rating:4.2, time:'30‚Äì40 min', fee:25, tags:['Tiffins','Veg'], featured:false},
      {id:'r4', name:'Warangal Mandi Co.', area:{en:'Hanamkonda', te:'‡∞π‡∞®‡±Å‡∞Æ‡∞ï‡±ä‡∞Ç‡∞°'}, city:'Warangal', rating:4.6, time:'35‚Äì45 min', fee:35, tags:['Mandi','Grill'], featured:true},
      {id:'r5', name:'Home Chef: Lakshmi', area:{en:'Guntur Central', te:'‡∞ó‡±Å‡∞Ç‡∞ü‡±Ç‡∞∞‡±Å ‡∞∏‡±Ü‡∞Ç‡∞ü‡±ç‡∞∞‡∞≤‡±ç'}, city:'Guntur', rating:4.7, time:'40‚Äì55 min', fee:0, tags:['Home Food','Healthy'], featured:false}
    ],
    menuByRestaurant: {
      r1: [
        {id:'i1', name:{en:'Andhra Meals (Unlimited)', te:'‡∞Ü‡∞Ç‡∞ß‡±ç‡∞∞ ‡∞≠‡±ã‡∞ú‡∞®‡∞Ç (‡∞Ö‡∞®‡±ç‚Äå‡∞≤‡∞ø‡∞Æ‡∞ø‡∞ü‡±Ü‡∞°‡±ç)'}, desc:{en:'Rice, pappu, sambar, fry, curd, pickle', te:'‡∞Ö‡∞®‡±ç‡∞®‡∞Ç, ‡∞™‡∞™‡±ç‡∞™‡±Å, ‡∞∏‡∞æ‡∞Ç‡∞¨‡∞æ‡∞∞‡±ç, ‡∞´‡±ç‡∞∞‡±à, ‡∞™‡±Ü‡∞∞‡±Å‡∞ó‡±Å, ‡∞Ü‡∞ö‡∞æ‡∞∞‡∞Ç'}, price:189, veg:true, popular:true},
        {id:'i2', name:{en:'Gongura Chicken', te:'‡∞ó‡±ã‡∞Ç‡∞ó‡±Ç‡∞∞ ‡∞ö‡∞ø‡∞ï‡±Ü‡∞®‡±ç'}, desc:{en:'Tangy gongura, spicy masala', te:'‡∞™‡±Å‡∞≤‡±ç‡∞≤‡∞ü‡∞ø ‡∞ó‡±ã‡∞Ç‡∞ó‡±Ç‡∞∞, ‡∞ï‡∞æ‡∞∞‡∞Æ‡±à‡∞® ‡∞Æ‡∞∏‡∞æ‡∞≤‡∞æ'}, price:259, veg:false, popular:true},
        {id:'i3', name:{en:'Pesarattu + Upma', te:'‡∞™‡±Ü‡∞∏‡∞∞‡∞ü‡±ç‡∞ü‡±Å + ‡∞â‡∞™‡±ç‡∞Æ‡∞æ'}, desc:{en:'Crispy, protein-rich', te:'‡∞ï‡±ç‡∞∞‡∞ø‡∞∏‡±ç‡∞™‡±Ä, ‡∞™‡±ç‡∞∞‡±ã‡∞ü‡±Ä‡∞®‡±ç ‡∞∞‡∞ø‡∞ö‡±ç'}, price:119, veg:true, popular:false},
      ],
      r2: [
        {id:'i4', name:{en:'Chicken Dum Biryani', te:'‡∞ö‡∞ø‡∞ï‡±Ü‡∞®‡±ç ‡∞¶‡∞Æ‡±ç ‡∞¨‡∞ø‡∞∞‡±ç‡∞Ø‡∞æ‡∞®‡±Ä'}, desc:{en:'Hyderabadi-style with Andhra spice', te:'‡∞Ü‡∞Ç‡∞ß‡±ç‡∞∞ ‡∞ü‡∞ö‡±ç‚Äå‡∞§‡±ã ‡∞π‡±à‡∞¶‡∞∞‡∞æ‡∞¨‡∞æ‡∞¶‡∞ø ‡∞∏‡±ç‡∞ü‡±à‡∞≤‡±ç'}, price:249, veg:false, popular:true},
        {id:'i5', name:{en:'Double Ka Meetha', te:'‡∞°‡∞¨‡±Å‡∞≤‡±ç ‡∞ï‡∞æ ‡∞Æ‡±Ä‡∞†‡∞æ'}, desc:{en:'Classic dessert', te:'‡∞ï‡±ç‡∞≤‡∞æ‡∞∏‡∞ø‡∞ï‡±ç ‡∞∏‡±ç‡∞µ‡±Ä‡∞ü‡±ç'}, price:99, veg:true, popular:false},
      ],
      r3: [
        {id:'i6', name:{en:'Idli (4) + Sambar', te:'‡∞á‡∞°‡±ç‡∞≤‡±Ä (4) + ‡∞∏‡∞æ‡∞Ç‡∞¨‡∞æ‡∞∞‡±ç'}, desc:{en:'Soft idlis with hot sambar', te:'‡∞Æ‡±É‡∞¶‡±Å‡∞µ‡±à‡∞® ‡∞á‡∞°‡±ç‡∞≤‡±Ä, ‡∞µ‡±á‡∞°‡∞ø ‡∞∏‡∞æ‡∞Ç‡∞¨‡∞æ‡∞∞‡±ç'}, price:79, veg:true, popular:true},
        {id:'i7', name:{en:'Ghee Dosa', te:'‡∞®‡±Ü‡∞Ø‡±ç‡∞Ø‡∞ø ‡∞¶‡±ã‡∞∏'}, desc:{en:'Golden & crisp', te:'‡∞¨‡∞Ç‡∞ó‡∞æ‡∞∞‡±Å ‡∞∞‡∞Ç‡∞ó‡±Å, ‡∞ï‡±ç‡∞∞‡∞ø‡∞∏‡±ç‡∞™‡±Ä'}, price:99, veg:true, popular:false},
      ],
      r4: [
        {id:'i8', name:{en:'Chicken Mandi (Half)', te:'‡∞ö‡∞ø‡∞ï‡±Ü‡∞®‡±ç ‡∞Æ‡∞Ç‡∞°‡±Ä (‡∞π‡∞æ‡∞´‡±ç)'}, desc:{en:'Smoky rice + grilled chicken', te:'‡∞∏‡±ç‡∞Æ‡±ã‡∞ï‡±Ä ‡∞∞‡±à‡∞∏‡±ç + ‡∞ó‡±ç‡∞∞‡∞ø‡∞≤‡±ç ‡∞ö‡∞ø‡∞ï‡±Ü‡∞®‡±ç'}, price:399, veg:false, popular:true},
      ],
      r5: [
        {id:'i9', name:{en:'Home Veg Thali', te:'‡∞á‡∞Ç‡∞ü‡∞ø ‡∞µ‡±Ü‡∞ú‡±ç ‡∞•‡∞æ‡∞≤‡∞ø'}, desc:{en:'Simple, clean, home-style', te:'‡∞∏‡∞æ‡∞¶‡∞æ, ‡∞∂‡±Å‡∞≠‡±ç‡∞∞‡∞Ç, ‡∞á‡∞Ç‡∞ü‡∞ø ‡∞∞‡±Å‡∞ö‡∞ø'}, price:159, veg:true, popular:true},
        {id:'i10', name:{en:'Chicken Curry + Rice', te:'‡∞ö‡∞ø‡∞ï‡±Ü‡∞®‡±ç ‡∞ï‡∞∞‡±ç‡∞∞‡±Ä + ‡∞Ö‡∞®‡±ç‡∞®‡∞Ç'}, desc:{en:'Slow-cooked, mild spice', te:'‡∞∏‡±ç‡∞≤‡±ã ‡∞ï‡±Å‡∞ï‡±ç, ‡∞Æ‡±à‡∞≤‡±ç‡∞°‡±ç ‡∞∏‡±ç‡∞™‡±à‡∞∏‡±ç'}, price:219, veg:false, popular:false},
      ]
    },
    searchSuggestions: ['biryani','meals','tiffins','gongura','ulavacharu','Hyderabad style','home food']
  };

  const main = $('#main');
  const bottomTabs = $('#bottomTabs');

  function t(key){
    const L = i18n[state.lang] || i18n.en;
    return L[key] ?? key;
  }

  function fmt‚Çπ(n){return '‚Çπ' + Number(n).toFixed(0)}

  function save(){
    localStorage.setItem('c9_lang', state.lang);
    localStorage.setItem('c9_city', state.city);
    localStorage.setItem('c9_cart', JSON.stringify(state.cart));
    localStorage.setItem('c9_order', JSON.stringify(state.order));
  }

  function toast(msg){
    const el = $('#toast');
    el.textContent = msg;
    el.classList.add('show');
    setTimeout(()=>el.classList.remove('show'), 1400);
  }

  function nowTime(){
    const d = new Date();
    const hh = String(d.getHours()).padStart(2,'0');
    const mm = String(d.getMinutes()).padStart(2,'0');
    $('#sbTime').textContent = `${hh}:${mm}`;
  }
  setInterval(nowTime, 30000);
  nowTime();

  function setHeader({title, subtitle, canBack}){
    $('#headerTitle').textContent = title;
    $('#headerSubtitle').textContent = subtitle;
    $('#backBtn').style.visibility = canBack ? 'visible' : 'hidden';
  }

  function push(route, params={}){
    state.stack.push({route, params});
    render();
  }

  function replace(route, params={}){
    if(state.stack.length===0) state.stack.push({route, params});
    else state.stack[state.stack.length-1] = {route, params};
    render();
  }

  function pop(){
    if(state.stack.length>1){
      state.stack.pop();
      render();
    }
  }

  function setTab(tab){
    state.tab = tab;
    // Map tabs to screens
    if(tab==='home') replace('home');
    if(tab==='search') replace('search');
    if(tab==='restaurants') replace('listing');
    if(tab==='cart') replace('cart');
    if(tab==='profile') replace('profile');
    render();
  }

  function activeRoute(){
    return state.stack[state.stack.length-1] || {route:'onboarding', params:{}};
  }

  function renderTabs(){
    bottomTabs.style.display = (activeRoute().route==='onboarding') ? 'none' : 'block';
    $$('.tab', bottomTabs).forEach(btn => {
      btn.classList.toggle('active', btn.dataset.tab === state.tab);
    });

    // Translate tab labels
    $('#tabHome').textContent = t('home');
    $('#tabSearch').textContent = t('search');
    $('#tabRestaurants').textContent = t('restaurants');
    $('#tabCart').textContent = t('cart');
    $('#tabProfile').textContent = t('profile');
  }

  function screenOnboarding(){
    setHeader({
      title: t('app'),
      subtitle: t('orderFoodTe') + ' ‚Ä¢ ' + t('tagline'),
      canBack:false
    });

    const cityChoices = data.cities.map(c => {
      const active = state.city===c;
      return `<div class="radio ${active?'active':''}" data-action="pickCity" data-city="${c}">
        <div class="dot"></div>
        <div>${c}</div>
      </div>`;
    }).join('');

    const langTeActive = state.lang==='te';
    const langEnActive = state.lang==='en';

    main.innerHTML = `
      <div class="hero">
        <div class="brand">
          <div style="display:flex; gap:10px; align-items:center">
            <div class="logo">C9</div>
            <div>
              <div class="brandName">${t('app')}</div>
              <div class="tag">${t('orderFoodTe')}</div>
            </div>
          </div>
          <div class="badge yellow" title="Mockup">MVP Mock</div>
        </div>
        <div style="margin-top:12px; font-weight:1000; font-size:18px; letter-spacing:-.03em">${t('onboardingTitle')}</div>
        <div class="smallNote" style="margin-top:8px">${t('onboardingSub')}</div>

        <div class="sectionTitle" style="margin-top:14px">${t('chooseLang')}</div>
        <div class="langRow">
          <button class="btn btnSecondary langBtn" data-action="setLang" data-lang="te" style="border-color:${langTeActive?'rgba(255,107,53,.45)':'var(--line)'}; background:${langTeActive?'rgba(255,107,53,.08)':'#fff'}">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</button>
          <button class="btn btnSecondary langBtn" data-action="setLang" data-lang="en" style="border-color:${langEnActive?'rgba(255,107,53,.45)':'var(--line)'}; background:${langEnActive?'rgba(255,107,53,.08)':'#fff'}">English</button>
        </div>

        <div class="sectionTitle" style="margin-top:14px">${t('chooseCity')}</div>
        <div class="radioRow">${cityChoices}</div>

        <div class="divider"></div>
        <button class="btn" data-action="start">${t('continue')}</button>
        <div class="smallNote" style="margin-top:10px">Tip: Use the bottom tabs and back button to explore 9 screens: Home, Listing, Menu, Item Detail, Cart/Checkout, Tracking, Profile/History, Search, and this Onboarding.</div>
      </div>

      <div class="footerPad"></div>
    `;
  }

  function screenHome(){
    setHeader({
      title: t('orderFoodTe'),
      subtitle: `${state.city} ‚Ä¢ ${t('restaurants')} ‚Ä¢ Telugu-first`,
      canBack: state.stack.length>1
    });

    const cats = data.categories.map(c => `
      <div class="cat" data-action="openCategory" data-cat="${c.name.en}">
        <div class="emoji">${c.emoji}</div>
        <div class="name">${state.lang==='te' ? c.name.te : c.name.en}</div>
        <div class="hint">${state.lang==='te' ? c.hint.te : c.hint.en}</div>
      </div>
    `).join('');

    const offers = data.offers.map(o=>`
      <div class="offer">
        <div class="big">${state.lang==='te' ? o.big.te : o.big.en}</div>
        <div class="small">${state.lang==='te' ? o.small.te : o.small.en}</div>
      </div>
    `).join('');

    const featured = data.restaurants
      .filter(r=> r.featured)
      .slice(0,3)
      .map(r => restaurantCard(r))
      .join('');

    main.innerHTML = `
      <div class="search" data-action="gotoSearch" title="Search">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.3-4.3"/></svg>
        <input aria-label="Search" placeholder="${state.lang==='te' ? '‡∞¨‡∞ø‡∞∞‡±ç‡∞Ø‡∞æ‡∞®‡±Ä, ‡∞≠‡±ã‡∞ú‡∞®‡∞Ç, ‡∞ü‡∞ø‡∞´‡∞ø‡∞®‡±ç‡∞≤‡±Å‚Ä¶' : 'Biryani, meals, tiffins‚Ä¶'}" value="" readonly />
        <span class="badge yellow">${t('filters')}</span>
      </div>

      <div class="sectionTitle">${t('offers')}</div>
      <div class="grid2">${offers}</div>

      <div class="sectionTitle">${t('categories')}</div>
      <div class="grid2">${cats}</div>

      <div class="row" style="margin-top:14px">
        <div class="sectionTitle" style="margin:0">${t('featured')}</div>
        <button class="btn btnSecondary" data-action="viewAll">${t('viewAll')}</button>
      </div>
      <div class="list" style="margin-top:10px">${featured}</div>
      <div class="footerPad"></div>
    `;
  }

  function restaurantCard(r){
    const Larea = state.lang==='te' ? r.area.te : r.area.en;
    const cityOk = r.city===state.city || state.city==='Hyderabad';
    const cityBadge = cityOk ? '' : `<span class="badge">${r.city}</span>`;
    const ratingBadge = `<span class="badge green">‚òÖ ${r.rating.toFixed(1)}</span>`;
    const timeBadge = `<span class="badge">${r.time}</span>`;
    const feeBadge = `<span class="badge">${t('deliveryFee')}: ${r.fee===0 ? (state.lang==='te'?'‡∞´‡±ç‡∞∞‡±Ä':'FREE') : fmt‚Çπ(r.fee)}</span>`;
    const tags = r.tags.slice(0,2).map(x=>`<span class="badge yellow">${x}</span>`).join('');

    return `
      <div class="rCard" data-action="openRestaurant" data-id="${r.id}">
        <div class="rTop">
          <div class="thumb">${r.name.split(' ').slice(0,1).join('').toUpperCase()}</div>
          <div style="flex:1; min-width:0">
            <div class="rName">${r.name}</div>
            <div class="rMeta">${Larea} ‚Ä¢ ${r.city}</div>
            <div class="badges">${ratingBadge}${timeBadge}${feeBadge}${tags}${cityBadge}</div>
          </div>
        </div>
      </div>
    `;
  }

  function screenListing(){
    setHeader({
      title: t('restaurants'),
      subtitle: `${state.city} ‚Ä¢ ${t('filters')} ‚Ä¢ ‚òÖ4+ ${state.filters.rating4plus?'ON':'OFF'}`,
      canBack: state.stack.length>1
    });

    // quick filter chips
    const chips = [
      {id:'c1', label: state.lang==='te'?'‚òÖ 4+':'‚òÖ 4+', action:'toggleRating4'},
      {id:'c2', label: t('vegOnly'), action:'toggleVeg'},
      {id:'c3', label: state.lang==='te'?'‚Çπ30 ‡∞≤‡±ã‡∞™‡±Å ‡∞´‡±Ä':'Fee ‚â§ ‚Çπ30', action:'toggleFee30'},
      {id:'c4', label: state.lang==='te'?'‡∞∏‡∞æ‡∞∞‡±ç‡∞ü‡∞ø‡∞Ç‡∞ó‡±ç':'Sort', action:'cycleSort'},
    ].map(c=>`<div class="chip" data-action="${c.action}">${c.label}</div>`).join('');

    let list = data.restaurants.slice();

    // filter by city (show also some nearby for demo)
    list = list.filter(r => r.city===state.city || (state.city==='Hyderabad' ? true : r.featured));

    if(state.filters.rating4plus) list = list.filter(r => r.rating>=4.0);
    if(state.filters.maxDeliveryFee<=30) list = list.filter(r => r.fee<=30);
    if(state.filters.vegOnly) list = list.filter(r => (data.menuByRestaurant[r.id]||[]).some(i=>i.veg));

    // sort
    if(state.filters.sort==='Rating') list.sort((a,b)=>b.rating-a.rating);
    if(state.filters.sort==='Fastest') list.sort((a,b)=>parseInt(a.time)-parseInt(b.time));

    const html = list.map(restaurantCard).join('') || `<div class="card"><b>No results.</b><div class="smallNote" style="margin-top:6px">Try turning off filters.</div></div>`;

    main.innerHTML = `
      <div class="search" data-action="gotoSearch">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.3-4.3"/></svg>
        <input aria-label="Search" placeholder="${state.lang==='te' ? '‡∞∞‡±Ü‡∞∏‡±ç‡∞ü‡∞æ‡∞∞‡±Ü‡∞Ç‡∞ü‡±ç ‡∞≤‡±á‡∞¶‡∞æ ‡∞µ‡∞Ç‡∞ü‡∞ï‡∞Ç‚Ä¶' : 'Restaurant or dish‚Ä¶'}" readonly />
        <span class="badge yellow">${state.filters.sort}</span>
      </div>

      <div class="sectionTitle">${t('filters')}</div>
      <div class="chips">${chips}</div>

      <div class="sectionTitle" style="margin-top:14px">${state.lang==='te' ? '‡∞´‡∞≤‡∞ø‡∞§‡∞æ‡∞≤‡±Å' : 'Results'}</div>
      <div class="list">${html}</div>
      <div class="footerPad"></div>
    `;
  }

  function screenMenu(){
    const r = data.restaurants.find(x=>x.id===state.selectedRestaurantId) || data.restaurants[0];
    setHeader({
      title: r.name,
      subtitle: `${state.lang==='te' ? r.area.te : r.area.en} ‚Ä¢ ‚òÖ ${r.rating.toFixed(1)} ‚Ä¢ ${t('menu')}`,
      canBack: true
    });

    const menu = (data.menuByRestaurant[r.id] || []).map(it => {
      const dot = it.veg ? '<div class="vegDot" title="Veg"></div>' : '<div class="nonVegDot" title="Non-veg"></div>';
      const name = state.lang==='te' ? it.name.te : it.name.en;
      const desc = state.lang==='te' ? it.desc.te : it.desc.en;
      const pop = it.popular ? `<span class="badge yellow">${state.lang==='te'?'‡∞™‡∞æ‡∞™‡±Å‡∞≤‡∞∞‡±ç':'Popular'}</span>` : '';
      return `
        <div class="menuItem">
          <div class="menuLeft">
            ${dot}
            <div style="min-width:0">
              <div class="mName">${name} ${pop}</div>
              <div class="mDesc">${desc}</div>
              <div class="mPrice">${fmt‚Çπ(it.price)}</div>
            </div>
          </div>
          <button class="addBtn" data-action="openItem" data-id="${it.id}">${t('customize')}</button>
        </div>
      `;
    }).join('');

    main.innerHTML = `
      <div class="card">
        <div class="row">
          <div>
            <div style="font-weight:1000">${t('menu')}</div>
            <div class="smallNote" style="margin-top:6px">${state.lang==='te' ? '‡∞ê‡∞ü‡∞Æ‡±ç‚Äå‡∞®‡±Å ‡∞ü‡±ç‡∞Ø‡∞æ‡∞™‡±ç ‡∞ö‡±á‡∞∏‡∞ø ‡∞ï‡∞∏‡±ç‡∞ü‡∞Æ‡±à‡∞ú‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø.' : 'Tap an item to customize.'}</div>
          </div>
          <button class="btn btnSecondary" data-action="gotoCart">${t('cart')} (${cartCount()})</button>
        </div>
      </div>

      <div class="sectionTitle">${state.lang==='te' ? '‡∞Æ‡±Ü‡∞®‡±Ç ‡∞ê‡∞ü‡±Ü‡∞Æ‡±ç‡∞∏‡±ç' : 'Menu items'}</div>
      <div class="list">${menu}</div>
      <div class="footerPad"></div>
    `;
  }

  function screenItemDetail(){
    const r = data.restaurants.find(x=>x.id===state.selectedRestaurantId) || data.restaurants[0];
    const items = data.menuByRestaurant[r.id] || [];
    const it = items.find(x=>x.id===state.selectedItemId) || items[0];

    setHeader({
      title: (state.lang==='te' ? it.name.te : it.name.en),
      subtitle: `${r.name} ‚Ä¢ ${t('customize')}`,
      canBack: true
    });

    const choiceSpice = ['Mild','Medium','Spicy'].map((x,idx)=>{
      const labels = state.lang==='te'
        ? ['‡∞§‡∞ï‡±ç‡∞ï‡±Å‡∞µ','‡∞Æ‡±Ä‡∞°‡∞ø‡∞Ø‡∞Æ‡±ç','‡∞ï‡∞æ‡∞∞‡∞Ç']
        : ['Mild','Medium','Spicy'];
      const val = ['mild','medium','spicy'][idx];
      const active = (activeRoute().params.spice||'medium')===val;
      return `<div class="chip ${active?'active':''}" data-action="setSpice" data-val="${val}">${labels[idx]}</div>`;
    }).join('');

    const addOns = [
      {id:'a1', nameEn:'Extra ghee', nameTe:'‡∞é‡∞ï‡±ç‡∞∏‡±ç‚Äå‡∞ü‡±ç‡∞∞‡∞æ ‡∞®‡±Ü‡∞Ø‡±ç‡∞Ø‡∞ø', price:15},
      {id:'a2', nameEn:'Raita', nameTe:'‡∞∞‡±à‡∞§‡∞æ', price:20},
      {id:'a3', nameEn:'Papad', nameTe:'‡∞™‡∞™‡±ç‡∞™‡∞°‡±ç', price:10},
    ];

    const selectedAddOns = new Set(activeRoute().params.addOns || []);

    const addOnsHtml = addOns.map(a=>{
      const active = selectedAddOns.has(a.id);
      return `
        <div class="rCard" style="padding:10px" data-action="toggleAddon" data-id="${a.id}">
          <div class="row">
            <div>
              <div style="font-weight:950; font-size:13px">${state.lang==='te'?a.nameTe:a.nameEn}</div>
              <div class="smallNote">+ ${fmt‚Çπ(a.price)}</div>
            </div>
            <div class="badge ${active?'yellow':''}">${active ? (state.lang==='te'?'‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞∞‡±Å':'Selected') : (state.lang==='te'?'‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø':'Pick')}</div>
          </div>
        </div>
      `;
    }).join('');

    const noteVal = activeRoute().params.note || '';

    main.innerHTML = `
      <div class="card">
        <div style="font-weight:1000">${state.lang==='te'?it.desc.te:it.desc.en}</div>
        <div class="row" style="margin-top:10px">
          <div class="badge green">${it.veg ? (state.lang==='te'?'‡∞µ‡±Ü‡∞ú‡±ç':'Veg') : (state.lang==='te'?'‡∞®‡∞æ‡∞®‡±ç-‡∞µ‡±Ü‡∞ú‡±ç':'Non-veg')}</div>
          <div class="badge">${fmt‚Çπ(it.price)}</div>
        </div>
      </div>

      <div class="sectionTitle">${t('spicy')}</div>
      <div class="chips">${choiceSpice}</div>

      <div class="sectionTitle">${t('addOns')}</div>
      <div class="list">${addOnsHtml}</div>

      <div class="sectionTitle">${t('instructions')}</div>
      <div class="search" style="padding:12px">
        <input id="noteInput" placeholder="${state.lang==='te'?'‡∞â‡∞¶‡∞æ: ‡∞â‡∞™‡±ç‡∞™‡±Å ‡∞§‡∞ï‡±ç‡∞ï‡±Å‡∞µ, ‡∞ï‡∞æ‡∞∞‡∞Ç ‡∞é‡∞ï‡±ç‡∞ï‡±Å‡∞µ‚Ä¶':'e.g., less salt, extra spicy‚Ä¶'}" value="${escapeHtml(noteVal)}" />
      </div>

      <div style="margin-top:14px; display:flex; gap:10px">
        <button class="btn" style="flex:1" data-action="addToCart">${t('addToCart')}</button>
        <button class="btn btnSecondary" data-action="gotoCart">${t('cart')} (${cartCount()})</button>
      </div>
      <div class="footerPad"></div>
    `;

    // wire note input
    const note = $('#noteInput');
    note.addEventListener('input', ()=>{
      const top = activeRoute();
      top.params.note = note.value;
    });
  }

  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, c=>({
      '&':'&amp;', '<':'&lt;', '>':'&gt;', '"':'&quot;', "'":'&#39;'
    }[c]));
  }

  function cartCount(){
    return state.cart.reduce((sum, x)=> sum + x.qty, 0);
  }

  function cartSubtotal(){
    return state.cart.reduce((sum, x)=> sum + x.price*x.qty, 0);
  }

  function screenCart(){
    setHeader({
      title: t('cart'),
      subtitle: state.lang==='te' ? '‡∞ö‡±Ü‡∞ï‡±å‡∞ü‡±ç ‚Ä¢ ‡∞ö‡±Ü‡∞≤‡±ç‡∞≤‡∞ø‡∞Ç‡∞™‡±Å' : 'Checkout ‚Ä¢ Payment',
      canBack: state.stack.length>1
    });

    const itemsHtml = state.cart.map((x, idx)=>{
      return `
        <div class="menuItem">
          <div class="menuLeft">
            <div class="thumb" style="width:46px; height:46px">${x.restaurantShort}</div>
            <div style="min-width:0">
              <div class="mName">${x.name}</div>
              <div class="mDesc">${x.meta}</div>
              <div class="mPrice">${fmt‚Çπ(x.price)}</div>
            </div>
          </div>
          <div class="col" style="align-items:flex-end">
            <div class="stepper" data-action="noop">
              <button data-action="decQty" data-idx="${idx}">‚àí</button>
              <div class="qty">${x.qty}</div>
              <button data-action="incQty" data-idx="${idx}">+</button>
            </div>
            <button class="btn btnSecondary" style="padding:8px 10px; border-radius:14px" data-action="removeItem" data-idx="${idx}">${state.lang==='te'?'‡∞§‡±ä‡∞≤‡∞ó‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø':'Remove'}</button>
          </div>
        </div>
      `;
    }).join('') || `
      <div class="card">
        <div style="font-weight:1000">${state.lang==='te'?'‡∞Æ‡±Ä ‡∞ï‡∞æ‡∞∞‡±ç‡∞ü‡±ç ‡∞ñ‡∞æ‡∞≥‡±Ä‡∞ó‡∞æ ‡∞â‡∞Ç‡∞¶‡∞ø.':'Your cart is empty.'}</div>
        <div class="smallNote" style="margin-top:6px">${state.lang==='te'?'‡∞∞‡±Ü‡∞∏‡±ç‡∞ü‡∞æ‡∞∞‡±Ü‡∞Ç‡∞ü‡±ç ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±Å‡∞®‡∞ø ‡∞ê‡∞ü‡±Ü‡∞Æ‡±ç‡∞∏‡±ç ‡∞ú‡±ã‡∞°‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø.':'Pick a restaurant and add items.'}</div>
        <div style="margin-top:12px; display:flex; gap:10px">
          <button class="btn" data-action="goRestaurants" style="flex:1">${t('restaurants')}</button>
          <button class="btn btnSecondary" data-action="goHome">${t('home')}</button>
        </div>
      </div>
    `;

    const subtotal = cartSubtotal();
    const delivery = subtotal>199 ? 0 : 19;
    const taxes = Math.round(subtotal*0.05);
    const total = subtotal + delivery + taxes;

    const disabled = state.cart.length===0;

    main.innerHTML = `
      <div class="list">${itemsHtml}</div>

      <div class="sectionTitle">${t('address')}</div>
      <div class="card">
        <div style="font-weight:1000">${state.lang==='te'?'‡∞á‡∞≤‡±ç‡∞≤‡±Å ‚Ä¢ ‡∞Ü‡∞´‡±Ä‡∞∏‡±ç':'Home ‚Ä¢ Office'}</div>
        <div class="smallNote" style="margin-top:6px">${state.lang==='te' ? 'MG ‡∞∞‡±ã‡∞°‡±ç, ‡∞µ‡∞ø‡∞ú‡∞Ø‡∞µ‡∞æ‡∞° (‡∞°‡±Ü‡∞Æ‡±ã)' : 'MG Road, Vijayawada (demo)'}</div>
        <div class="divider"></div>
        <div class="row">
          <div class="badge yellow">${state.lang==='te'?'‡∞ú‡∞æ‡∞ó‡±ç‡∞∞‡∞§‡±ç‡∞§':'Tip'}</div>
          <div class="smallNote">${state.lang==='te'?'UPI ‡∞§‡±ã ‡∞µ‡±á‡∞ó‡∞Ç‡∞ó‡∞æ ‡∞ö‡±Ü‡∞≤‡±ç‡∞≤‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø.':'Pay faster with UPI.'}</div>
        </div>
      </div>

      <div class="sectionTitle">${t('payment')}</div>
      <div class="chips">
        <div class="chip active" data-action="noop">${t('upi')}</div>
        <div class="chip" data-action="noop">${t('cod')}</div>
      </div>

      <div class="sectionTitle">${state.lang==='te'?'‡∞¨‡∞ø‡∞≤‡±ç ‡∞µ‡∞ø‡∞µ‡∞∞‡∞æ‡∞≤‡±Å':'Bill details'}</div>
      <div class="card">
        <div class="kv"><div class="k">${state.lang==='te'?'‡∞∏‡∞¨‡±ç‚Äå‡∞ü‡±ã‡∞ü‡∞≤‡±ç':'Subtotal'}</div><div class="v">${fmt‚Çπ(subtotal)}</div></div>
        <div class="kv" style="margin-top:8px"><div class="k">${t('deliveryFee')}</div><div class="v">${delivery===0 ? (state.lang==='te'?'‡∞´‡±ç‡∞∞‡±Ä':'FREE') : fmt‚Çπ(delivery)}</div></div>
        <div class="kv" style="margin-top:8px"><div class="k">${state.lang==='te'?'‡∞ü‡±ç‡∞Ø‡∞æ‡∞ï‡±ç‡∞∏‡±ç':'Taxes'}</div><div class="v">${fmt‚Çπ(taxes)}</div></div>
        <div class="divider"></div>
        <div class="kv"><div class="k" style="font-weight:1000; color:#111827">${state.lang==='te'?'‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç':'Total'}</div><div class="v" style="font-size:16px">${fmt‚Çπ(total)}</div></div>
      </div>

      <div style="margin-top:14px">
        <button class="btn" style="width:100%; opacity:${disabled?0.5:1}" ${disabled?'disabled':''} data-action="placeOrder">${t('payNow')}</button>
        <div class="smallNote" style="margin-top:8px">${state.lang==='te' ? '‡∞°‡±Ü‡∞Æ‡±ã ‡∞Æ‡∞æ‡∞§‡±ç‡∞∞‡∞Æ‡±á: ‡∞ö‡±Ü‡∞≤‡±ç‡∞≤‡∞ø‡∞Ç‡∞™‡±Å ‡∞∏‡∞ø‡∞Æ‡±ç‡∞Ø‡±Å‡∞≤‡±á‡∞ü‡±ç ‡∞ö‡±á‡∞Ø‡∞¨‡∞°‡±Å‡∞§‡±Å‡∞Ç‡∞¶‡∞ø.' : 'Demo only: payment is simulated.'}</div>
      </div>
      <div class="footerPad"></div>
    `;
  }

  function screenTracking(){
    setHeader({
      title: t('orderTracking'),
      subtitle: state.order ? `${state.lang==='te'?'‡∞Ü‡∞∞‡±ç‡∞°‡∞∞‡±ç':'Order'} #${state.order.id} ‚Ä¢ ${t('est')}: ${state.order.eta}` : (state.lang==='te'?'‡∞á‡∞Ç‡∞ï‡∞æ ‡∞Ü‡∞∞‡±ç‡∞°‡∞∞‡±ç ‡∞≤‡±á‡∞¶‡±Å':'No order yet'),
      canBack: state.stack.length>1
    });

    const steps = state.order ? state.order.steps : [
      {k: state.lang==='te'?'‡∞Ü‡∞∞‡±ç‡∞°‡∞∞‡±ç ‡∞™‡±ç‡∞≤‡±á‡∞∏‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø':'Place an order', v: state.lang==='te'?'‡∞ï‡∞æ‡∞∞‡±ç‡∞ü‡±ç ‡∞®‡±Å‡∞Ç‡∞ö‡∞ø ‡∞ö‡±Ü‡∞≤‡±ç‡∞≤‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø.':'Checkout from cart.'},
    ];

    const stepHtml = steps.map((s,idx)=>`
      <div class="rCard" style="padding:12px">
        <div style="font-weight:1000">${idx+1}. ${s.k}</div>
        <div class="smallNote" style="margin-top:6px">${s.v}</div>
      </div>
    `).join('');

    main.innerHTML = `
      <div class="map">
        <div style="font-weight:1000; font-size:14px">Map Placeholder</div>
        <div class="smallNote">${state.lang==='te' ? '‡∞≤‡±à‡∞µ‡±ç ‡∞Æ‡±ç‡∞Ø‡∞æ‡∞™‡±ç (Google Maps) ‚Äî MVP ‡∞≤‡±ã ‡∞á‡∞ï‡±ç‡∞ï‡∞° ‡∞ö‡±Ç‡∞™‡∞ø‡∞∏‡±ç‡∞§‡∞æ‡∞Ç.' : 'Live map (Google Maps) ‚Äî shown here in the MVP.'}</div>
        <div class="badge yellow">${t('orderTracking')}</div>
      </div>

      <div class="sectionTitle">${state.lang==='te'?'‡∞∏‡±ç‡∞•‡∞ø‡∞§‡∞ø':'Status'}</div>
      <div class="list">${stepHtml}</div>

      <div style="margin-top:12px; display:flex; gap:10px">
        <button class="btn btnSecondary" style="flex:1" data-action="simulateMove">${state.lang==='te'?'‡∞Ö‡∞™‡±ç‡∞°‡±á‡∞ü‡±ç ‡∞∏‡∞ø‡∞Æ‡±ç‡∞Ø‡±Å‡∞≤‡±á‡∞ü‡±ç':'Simulate update'}</button>
        <button class="btn" style="flex:1" data-action="goHome">${t('home')}</button>
      </div>
      <div class="footerPad"></div>
    `;
  }

  function screenProfile(){
    setHeader({
      title: t('profile'),
      subtitle: state.lang==='te' ? '‡∞Ü‡∞∞‡±ç‡∞°‡∞∞‡±ç ‡∞ö‡∞∞‡∞ø‡∞§‡±ç‡∞∞ ‚Ä¢ ‡∞∏‡±Ü‡∞ü‡±ç‡∞ü‡∞ø‡∞Ç‡∞ó‡±ç‡∞∏‡±ç' : 'Order history ‚Ä¢ Settings',
      canBack: state.stack.length>1
    });

    const orders = (JSON.parse(localStorage.getItem('c9_history') || '[]'));
    const orderCards = orders.slice().reverse().slice(0,6).map(o=>`
      <div class="rCard" data-action="openTracking" data-id="${o.id}">
        <div class="row">
          <div>
            <div style="font-weight:1000">${o.restaurant}</div>
            <div class="smallNote">${o.date} ‚Ä¢ ${o.items} ${state.lang==='te'?'‡∞ê‡∞ü‡±Ü‡∞Æ‡±ç‡∞∏‡±ç':'items'} ‚Ä¢ ${fmt‚Çπ(o.total)}</div>
          </div>
          <div class="badge green">${state.lang==='te'?'‡∞ö‡±Ç‡∞°‡∞Ç‡∞°‡∞ø':'View'}</div>
        </div>
      </div>
    `).join('') || `
      <div class="card">
        <div style="font-weight:1000">${state.lang==='te'?'‡∞á‡∞Ç‡∞ï‡∞æ ‡∞Ü‡∞∞‡±ç‡∞°‡∞∞‡±ç ‡∞ö‡∞∞‡∞ø‡∞§‡±ç‡∞∞ ‡∞≤‡±á‡∞¶‡±Å.':'No orders yet.'}</div>
        <div class="smallNote" style="margin-top:6px">${state.lang==='te'?'‡∞Æ‡±Ä ‡∞Æ‡±ä‡∞¶‡∞ü‡∞ø ‡∞Ü‡∞∞‡±ç‡∞°‡∞∞‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø.':'Place your first order.'}</div>
      </div>
    `;

    main.innerHTML = `
      <div class="card">
        <div class="row">
          <div>
            <div style="font-weight:1000">Prakash</div>
            <div class="smallNote" style="margin-top:4px">+91 ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 99</div>
          </div>
          <button class="btn btnSecondary" data-action="switchCity">${t('city')}: ${state.city}</button>
        </div>
        <div class="divider"></div>
        <div class="chips">
          <div class="chip" data-action="gotoTracking">${t('orderTracking')}</div>
          <div class="chip" data-action="gotoSearch">${t('search')}</div>
          <div class="chip" data-action="clearCart">${state.lang==='te'?'‡∞ï‡∞æ‡∞∞‡±ç‡∞ü‡±ç ‡∞ï‡±ç‡∞≤‡∞ø‡∞Ø‡∞∞‡±ç':'Clear cart'}</div>
        </div>
      </div>

      <div class="sectionTitle">${t('pastOrders')}</div>
      <div class="list">${orderCards}</div>

      <div class="sectionTitle">${state.lang==='te'?'‡∞≠‡∞æ‡∞∑':'Language'}</div>
      <div class="chips">
        <div class="chip ${state.lang==='te'?'active':''}" data-action="setLang" data-lang="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</div>
        <div class="chip ${state.lang==='en'?'active':''}" data-action="setLang" data-lang="en">English</div>
      </div>
      <div class="footerPad"></div>
    `;
  }

  function screenSearch(){
    setHeader({
      title: t('search'),
      subtitle: state.lang==='te' ? '‡∞´‡∞ø‡∞≤‡±ç‡∞ü‡∞∞‡±ç‡∞≤‡±Å ‚Ä¢ ‡∞ï‡±á‡∞ü‡∞ó‡∞ø‡∞∞‡±Ä‡∞≤‡±Å' : 'Filters ‚Ä¢ Categories',
      canBack: state.stack.length>1
    });

    const q = state.searchQuery;
    const suggestions = data.searchSuggestions.map(s=>`<div class="chip" data-action="setQuery" data-q="${s}">${s}</div>`).join('');

    // Search results across restaurant names & menu items
    const results = [];
    const qlc = q.trim().toLowerCase();

    if(qlc){
      // restaurants
      data.restaurants.forEach(r=>{
        if(r.name.toLowerCase().includes(qlc)) results.push({type:'r', r});
      });
      // items
      Object.entries(data.menuByRestaurant).forEach(([rid, items])=>{
        const r = data.restaurants.find(x=>x.id===rid);
        items.forEach(it=>{
          const name = (state.lang==='te'?it.name.te:it.name.en);
          if(String(name).toLowerCase().includes(qlc)) results.push({type:'i', r, it});
        });
      });
    }

    const filters = `
      <div class="chips">
        <div class="chip ${state.filters.rating4plus?'active':''}" data-action="toggleRating4">‚òÖ 4+</div>
        <div class="chip ${state.filters.vegOnly?'active':''}" data-action="toggleVeg">${t('vegOnly')}</div>
        <div class="chip ${state.filters.maxDeliveryFee<=30?'active':''}" data-action="toggleFee30">${state.lang==='te'?'‚Çπ30 ‡∞≤‡±ã‡∞™‡±Å ‡∞´‡±Ä':'Fee ‚â§ ‚Çπ30'}</div>
      </div>
    `;

    const resHtml = !qlc
      ? `<div class="card"><div style="font-weight:1000">${state.lang==='te'?'‡∞µ‡±Ü‡∞§‡∞ï‡∞°‡∞Ç ‡∞™‡±ç‡∞∞‡∞æ‡∞∞‡∞Ç‡∞≠‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø':'Start searching'}</div><div class="smallNote" style="margin-top:6px">${state.lang==='te'?'‡∞∏‡∞ú‡±Ü‡∞∑‡∞®‡±ç‡∞≤‡±Å ‡∞ü‡±ç‡∞Ø‡∞æ‡∞™‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø ‡∞≤‡±á‡∞¶‡∞æ ‡∞ü‡±à‡∞™‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø.':'Tap a suggestion or type.'}</div></div>`
      : (results.length ? results.slice(0,8).map(x=>{
          if(x.type==='r') return restaurantCard(x.r);
          const nm = state.lang==='te'?x.it.name.te:x.it.name.en;
          return `
            <div class="rCard" data-action="openItemFromSearch" data-rid="${x.r.id}" data-iid="${x.it.id}">
              <div class="row">
                <div>
                  <div style="font-weight:1000">${nm}</div>
                  <div class="smallNote">${x.r.name} ‚Ä¢ ${fmt‚Çπ(x.it.price)}</div>
                </div>
                <div class="badge yellow">${t('menu')}</div>
              </div>
            </div>
          `;
      }).join('') : `<div class="card"><div style="font-weight:1000">${state.lang==='te'?'‡∞´‡∞≤‡∞ø‡∞§‡∞æ‡∞≤‡±Å ‡∞≤‡±á‡∞µ‡±Å':'No results'}</div><div class="smallNote" style="margin-top:6px">${state.lang==='te'?'‡∞á‡∞Ç‡∞ï‡±ã ‡∞™‡∞¶‡∞Ç ‡∞™‡±ç‡∞∞‡∞Ø‡∞§‡±ç‡∞®‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø.':'Try another term.'}</div></div>`);

    main.innerHTML = `
      <div class="search" style="gap:8px">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.3-4.3"/></svg>
        <input id="searchInput" placeholder="${state.lang==='te'?'‡∞â‡∞¶‡∞æ: ‡∞¨‡∞ø‡∞∞‡±ç‡∞Ø‡∞æ‡∞®‡±Ä, ‡∞≠‡±ã‡∞ú‡∞®‡∞Ç, ‡∞ó‡±ã‡∞Ç‡∞ó‡±Ç‡∞∞‚Ä¶':'e.g., biryani, meals, gongura‚Ä¶'}" value="${escapeHtml(q)}" />
        <button class="btn btnSecondary" style="padding:9px 10px; border-radius:14px" data-action="clearQuery">${state.lang==='te'?'‡∞ï‡±ç‡∞≤‡∞ø‡∞Ø‡∞∞‡±ç':'Clear'}</button>
      </div>

      <div class="sectionTitle">${t('filters')}</div>
      ${filters}

      <div class="sectionTitle">${state.lang==='te'?'‡∞∏‡∞ú‡±Ü‡∞∑‡∞®‡±ç‡∞≤‡±Å':'Suggestions'}</div>
      <div class="chips">${suggestions}</div>

      <div class="sectionTitle">${state.lang==='te'?'‡∞´‡∞≤‡∞ø‡∞§‡∞æ‡∞≤‡±Å':'Results'}</div>
      <div class="list">${resHtml}</div>
      <div class="footerPad"></div>
    `;

    $('#searchInput').addEventListener('input', (e)=>{
      state.searchQuery = e.target.value;
      render();
    });
  }

  function render(){
    $('#sbCity').textContent = state.city;
    renderTabs();

    const {route} = activeRoute();

    // Keep tab highlight coherent
    const tabByRoute = {
      home:'home',
      listing:'restaurants',
      menu:'restaurants',
      item:'restaurants',
      cart:'cart',
      tracking:'profile',
      profile:'profile',
      search:'search',
      onboarding:null
    };
    if(tabByRoute[route]) state.tab = tabByRoute[route];

    // Mark active tab
    $$('.tab', bottomTabs).forEach(btn => btn.classList.toggle('active', btn.dataset.tab===state.tab));

    if(route==='onboarding') screenOnboarding();
    if(route==='home') screenHome();
    if(route==='listing') screenListing();
    if(route==='menu') screenMenu();
    if(route==='item') screenItemDetail();
    if(route==='cart') screenCart();
    if(route==='tracking') screenTracking();
    if(route==='profile') screenProfile();
    if(route==='search') screenSearch();

    save();
  }

  function ensureHistory(){
    const h = JSON.parse(localStorage.getItem('c9_history') || '[]');
    localStorage.setItem('c9_history', JSON.stringify(h));
  }

  function addHistory(entry){
    const h = JSON.parse(localStorage.getItem('c9_history') || '[]');
    h.push(entry);
    localStorage.setItem('c9_history', JSON.stringify(h));
  }

  function placeOrder(){
    if(state.cart.length===0){ toast(state.lang==='te'?'‡∞Æ‡±Å‡∞Ç‡∞¶‡±Å ‡∞ê‡∞ü‡±Ü‡∞Æ‡±ç‡∞∏‡±ç ‡∞ú‡±ã‡∞°‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø':'Add items first'); return; }
    const total = cartSubtotal() + (cartSubtotal()>199?0:19) + Math.round(cartSubtotal()*0.05);
    const rName = state.cart[0]?.restaurantName || 'Restaurant';

    const id = String(Math.floor(100000 + Math.random()*900000));
    const eta = `${25 + Math.floor(Math.random()*15)}‚Äì${45 + Math.floor(Math.random()*10)} min`;
    const order = {
      id,
      eta,
      restaurant: rName,
      total,
      steps: [
        {k: state.lang==='te'?'‡∞Ü‡∞∞‡±ç‡∞°‡∞∞‡±ç ‡∞ï‡∞®‡±ç‡∞´‡∞∞‡±ç‡∞Æ‡±ç':'Order confirmed', v: state.lang==='te'?'‡∞∞‡±Ü‡∞∏‡±ç‡∞ü‡∞æ‡∞∞‡±Ü‡∞Ç‡∞ü‡±ç ‡∞Ü‡∞Æ‡±ã‡∞¶‡∞ø‡∞Ç‡∞ö‡∞ø‡∞Ç‡∞¶‡∞ø.':'Accepted by restaurant.'},
        {k: state.lang==='te'?'‡∞µ‡∞Ç‡∞ü ‡∞™‡±ç‡∞∞‡∞æ‡∞∞‡∞Ç‡∞≠‡∞Ç':'Cooking started', v: state.lang==='te'?'‡∞Æ‡±Ä ‡∞Ü‡∞π‡∞æ‡∞∞‡∞Ç ‡∞§‡∞Ø‡∞æ‡∞∞‡∞µ‡±Å‡∞§‡±ã‡∞Ç‡∞¶‡∞ø.':'Your food is being prepared.'},
        {k: state.lang==='te'?'‡∞°‡±Ü‡∞≤‡∞ø‡∞µ‡∞∞‡±Ä ‡∞™‡∞æ‡∞∞‡±ç‡∞ü‡±ç‡∞®‡∞∞‡±ç ‡∞Ö‡∞∏‡±à‡∞®‡±ç':'Rider assigned', v: state.lang==='te'?'‡∞∞‡±à‡∞°‡∞∞‡±ç ‡∞™‡∞ø‡∞ï‡∞™‡±ç ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞µ‡±Ü‡∞≥‡±ç‡∞§‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞°‡±Å.':'Rider is heading to pickup.'},
      ],
      progress: 0
    };

    state.order = order;

    addHistory({
      id,
      restaurant: rName,
      date: new Date().toLocaleString([], {year:'numeric', month:'short', day:'2-digit', hour:'2-digit', minute:'2-digit'}),
      items: cartCount(),
      total
    });

    state.cart = [];
    toast(state.lang==='te'?'‡∞Ü‡∞∞‡±ç‡∞°‡∞∞‡±ç ‡∞™‡±ç‡∞≤‡±á‡∞∏‡±ç ‡∞Ö‡∞Ø‡±ç‡∞Ø‡∞ø‡∞Ç‡∞¶‡∞ø!':'Order placed!');
    push('tracking');
  }

  function simulateMove(){
    if(!state.order){ toast(state.lang==='te'?'‡∞Æ‡±Å‡∞Ç‡∞¶‡±Å ‡∞Ü‡∞∞‡±ç‡∞°‡∞∞‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø':'Place an order first'); return; }
    const k = [
      {k: state.lang==='te'?'‡∞™‡∞ø‡∞ï‡∞™‡±ç ‡∞Ö‡∞Ø‡±ç‡∞Ø‡∞ø‡∞Ç‡∞¶‡∞ø':'Picked up', v: state.lang==='te'?'‡∞Ü‡∞π‡∞æ‡∞∞‡∞Ç ‡∞∞‡±à‡∞°‡∞∞‡±ç ‡∞µ‡∞¶‡±ç‡∞¶ ‡∞â‡∞Ç‡∞¶‡∞ø.':'Food picked up by rider.'},
      {k: state.lang==='te'?'‡∞¶‡∞æ‡∞∞‡∞ø‡∞≤‡±ã ‡∞â‡∞Ç‡∞¶‡∞ø':'On the way', v: state.lang==='te'?'‡∞Æ‡±Ä ‡∞ö‡∞ø‡∞∞‡±Å‡∞®‡∞æ‡∞Æ‡∞æ‡∞ï‡±Å ‡∞µ‡∞∏‡±ç‡∞§‡±ã‡∞Ç‡∞¶‡∞ø.':'Heading to your address.'},
      {k: state.lang==='te'?'‡∞°‡±Ü‡∞≤‡∞ø‡∞µ‡∞∞‡±ç ‡∞Ö‡∞Ø‡∞ø‡∞Ç‡∞¶‡∞ø':'Delivered', v: state.lang==='te'?'‡∞∏‡∞Ç‡∞§‡±ã‡∞∑‡∞Ç‡∞ó‡∞æ ‡∞§‡∞ø‡∞®‡∞Ç‡∞°‡∞ø!':'Enjoy your meal!'}
    ];
    state.order.progress = Math.min(3, (state.order.progress||0) + 1);
    if(state.order.progress===1) state.order.steps.push(k[0]);
    if(state.order.progress===2) state.order.steps.push(k[1]);
    if(state.order.progress===3) state.order.steps.push(k[2]);
    toast(state.lang==='te'?'‡∞∏‡±ç‡∞ü‡±á‡∞ü‡∞∏‡±ç ‡∞Ö‡∞™‡±ç‡∞°‡±á‡∞ü‡±ç ‡∞Ö‡∞Ø‡±ç‡∞Ø‡∞ø‡∞Ç‡∞¶‡∞ø':'Status updated');
    render();
  }

  // Global event delegation
  document.addEventListener('click', (e)=>{
    const tab = e.target.closest('.tab');
    if(tab){ setTab(tab.dataset.tab); return; }

    const back = e.target.closest('#backBtn');
    if(back){ pop(); return; }

    const act = e.target.closest('[data-action]');
    if(!act) return;

    const action = act.dataset.action;

    if(action==='start'){
      state.stack = [{route:'home', params:{}}];
      state.tab = 'home';
      render();
      toast(state.lang==='te'?'‡∞∏‡±ç‡∞µ‡∞æ‡∞ó‡∞§‡∞Ç!':'Welcome!');
      return;
    }

    if(action==='setLang'){
      state.lang = act.dataset.lang;
      save();
      toast(state.lang==='te'?'‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å ‡∞Ü‡∞®‡±ç':'Telugu ON');
      render();
      return;
    }

    if(action==='pickCity'){
      state.city = act.dataset.city;
      save();
      render();
      return;
    }

    if(action==='openCategory'){
      state.selectedCategory = act.dataset.cat;
      toast(`${state.selectedCategory}`);
      replace('listing');
      return;
    }

    if(action==='viewAll'){
      replace('listing');
      return;
    }

    if(action==='gotoSearch'){
      state.tab='search';
      replace('search');
      return;
    }

    if(action==='openRestaurant'){
      state.selectedRestaurantId = act.dataset.id;
      push('menu');
      return;
    }

    if(action==='openItem'){
      state.selectedItemId = act.dataset.id;
      push('item', {spice:'medium', addOns:[], note:''});
      return;
    }

    if(action==='setSpice'){
      activeRoute().params.spice = act.dataset.val;
      render();
      return;
    }

    if(action==='toggleAddon'){
      const top = activeRoute();
      top.params.addOns = top.params.addOns || [];
      const id = act.dataset.id;
      const s = new Set(top.params.addOns);
      if(s.has(id)) s.delete(id); else s.add(id);
      top.params.addOns = Array.from(s);
      render();
      return;
    }

    if(action==='addToCart'){
      // build cart item
      const r = data.restaurants.find(x=>x.id===state.selectedRestaurantId);
      const it = (data.menuByRestaurant[r.id]||[]).find(x=>x.id===state.selectedItemId);
      const top = activeRoute();
      const spice = top.params.spice || 'medium';
      const addOns = top.params.addOns || [];
      const note = top.params.note || '';

      const addOnPrice = ({a1:15,a2:20,a3:10});
      const extra = addOns.reduce((sum,id)=>sum+(addOnPrice[id]||0),0);

      const metaParts = [];
      metaParts.push(state.lang==='te' ? `‡∞ï‡∞æ‡∞∞‡∞Ç: ${spice}` : `Spice: ${spice}`);
      if(addOns.length) metaParts.push(state.lang==='te' ? `‡∞Ö‡∞°‡±ç‡∞°‡∞æ‡∞®‡±ç‚Äå‡∞≤‡±Å: ${addOns.join(', ')}` : `Add-ons: ${addOns.join(', ')}`);
      if(note.trim()) metaParts.push(state.lang==='te' ? `‡∞ó‡∞Æ‡∞®‡∞ø‡∞ï: ${note.trim()}` : `Note: ${note.trim()}`);

      state.cart.push({
        restaurantId: r.id,
        restaurantName: r.name,
        restaurantShort: r.name.split(' ').slice(0,1).join('').toUpperCase(),
        itemId: it.id,
        name: (state.lang==='te'?it.name.te:it.name.en),
        meta: metaParts.join(' ‚Ä¢ '),
        price: it.price + extra,
        qty: 1
      });
      toast(state.lang==='te'?'‡∞ï‡∞æ‡∞∞‡±ç‡∞ü‡±ç‚Äå‡∞≤‡±ã ‡∞ú‡±ã‡∞°‡∞ø‡∞Ç‡∞ö‡∞æ‡∞Ç':'Added to cart');
      save();
      replace('cart');
      state.tab='cart';
      return;
    }

    if(action==='gotoCart'){
      state.tab='cart';
      replace('cart');
      return;
    }

    if(action==='incQty'){
      const idx = Number(act.dataset.idx);
      state.cart[idx].qty++;
      save();
      render();
      return;
    }

    if(action==='decQty'){
      const idx = Number(act.dataset.idx);
      state.cart[idx].qty = Math.max(1, state.cart[idx].qty-1);
      save();
      render();
      return;
    }

    if(action==='removeItem'){
      const idx = Number(act.dataset.idx);
      state.cart.splice(idx,1);
      save();
      render();
      return;
    }

    if(action==='placeOrder'){
      placeOrder();
      return;
    }

    if(action==='simulateMove'){
      simulateMove();
      return;
    }

    if(action==='goRestaurants'){
      state.tab='restaurants';
      replace('listing');
      return;
    }

    if(action==='goHome'){
      state.tab='home';
      replace('home');
      return;
    }

    if(action==='gotoTracking'){
      push('tracking');
      return;
    }

    if(action==='openTracking'){
      // just go to tracking screen for demo
      push('tracking');
      return;
    }

    if(action==='openItemFromSearch'){
      state.selectedRestaurantId = act.dataset.rid;
      state.selectedItemId = act.dataset.iid;
      push('menu');
      push('item', {spice:'medium', addOns:[], note:''});
      return;
    }

    if(action==='setQuery'){
      state.searchQuery = act.dataset.q;
      render();
      return;
    }

    if(action==='clearQuery'){
      state.searchQuery = '';
      render();
      return;
    }

    if(action==='toggleRating4'){
      state.filters.rating4plus = !state.filters.rating4plus;
      render();
      return;
    }

    if(action==='toggleVeg'){
      state.filters.vegOnly = !state.filters.vegOnly;
      render();
      return;
    }

    if(action==='toggleFee30'){
      state.filters.maxDeliveryFee = (state.filters.maxDeliveryFee<=30) ? 999 : 30;
      render();
      return;
    }

    if(action==='cycleSort'){
      const order = ['Relevance','Rating','Fastest'];
      const i = order.indexOf(state.filters.sort);
      state.filters.sort = order[(i+1)%order.length];
      toast(state.filters.sort);
      render();
      return;
    }

    if(action==='switchCity'){
      const idx = (data.cities.indexOf(state.city) + 1) % data.cities.length;
      state.city = data.cities[idx];
      toast(`${t('city')}: ${state.city}`);
      render();
      return;
    }

    if(action==='clearCart'){
      state.cart = [];
      toast(state.lang==='te'?'‡∞ï‡∞æ‡∞∞‡±ç‡∞ü‡±ç ‡∞ï‡±ç‡∞≤‡∞ø‡∞Ø‡∞∞‡±ç ‡∞Ö‡∞Ø‡±ç‡∞Ø‡∞ø‡∞Ç‡∞¶‡∞ø':'Cart cleared');
      render();
      return;
    }
  });

  $('#langToggle').addEventListener('click', ()=>{
    state.lang = (state.lang==='te') ? 'en' : 'te';
    toast(state.lang==='te'?'‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å':'English');
    render();
  });

  $('#helpBtn').addEventListener('click', ()=>{
    const msg = state.lang==='te'
      ? '‡∞°‡±Ü‡∞Æ‡±ã: ‡∞ï‡±á‡∞ü‡∞ó‡∞ø‡∞∞‡±Ä ‚Üí ‡∞∞‡±Ü‡∞∏‡±ç‡∞ü‡∞æ‡∞∞‡±Ü‡∞Ç‡∞ü‡±ç ‚Üí ‡∞Æ‡±Ü‡∞®‡±Ç ‚Üí ‡∞ê‡∞ü‡∞Æ‡±ç ‡∞ï‡∞∏‡±ç‡∞ü‡∞Æ‡±à‡∞ú‡±ç ‚Üí ‡∞ï‡∞æ‡∞∞‡±ç‡∞ü‡±ç ‚Üí ‡∞ö‡±Ü‡∞≤‡±ç‡∞≤‡∞ø‡∞Ç‡∞™‡±Å ‚Üí ‡∞Ü‡∞∞‡±ç‡∞°‡∞∞‡±ç ‡∞ü‡±ç‡∞∞‡∞æ‡∞ï‡∞ø‡∞Ç‡∞ó‡±ç.'
      : 'Demo: Category ‚Üí Restaurant ‚Üí Menu ‚Üí Customize item ‚Üí Cart ‚Üí Pay ‚Üí Track order.';
    toast(msg);
  });

  // Init
  ensureHistory();
  state.stack = [{route: (localStorage.getItem('c9_seen') ? 'home' : 'onboarding'), params:{}}];
  if(state.stack[0].route==='home') state.tab='home';
  render();

  // mark seen when leaving onboarding
  const originalPush = push;
  // Patch start button already sets stack; just set seen when not onboarding
  const seenTimer = setInterval(()=>{
    if(activeRoute().route!=='onboarding'){
      localStorage.setItem('c9_seen','1');
      clearInterval(seenTimer);
    }
  }, 300);
})();
</script>
</body>
</html>
